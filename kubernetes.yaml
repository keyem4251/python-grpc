---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: marketplace
  labels: 
    app: marketplace
spec:
  replicas: 3
  selector: 
    matchLabels:
      app: marketplace
  template:
    metadata:
      labels:
        app: marketplace
    spec:
      containers:
        - name: marketplace
          image: keyem4251/marketplace:0.1
          env:
            - name: RECOMMENDATIONS_HOST
              value: recommendations
          envFrom:
          - secretRef:
              name: firebase-config
      
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: recommendations
  labels:
    app: recommendations
spec:
  replicas: 3
  selector:
    matchLabels:
      app: recommendations
  template:
    metadata:
      labels:
        app: recommendations
    spec:
      containers:
        - name: recommendations
          image: keyem4251/recommendations:0.1
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: auth
  labels: 
    app: auth
spec:
  replicas: 3
  selector:
    matchLabels:
      app: auth
  template:
    metadata:
      labels:
        app: auth
    spec:
      containers:
        - name: auth
          image: keyem4251/auth:0.1
---
apiVersion: v1
kind: Service
metadata:
  name: recommendations
spec:
  selector:
    app: recommendations
  ports:
    - protocol: TCP
      port: 50051
      targetPort: 50051
---
apiVersion: v1
kind: Service
metadata:
  name: marketplace
spec:
  type: LoadBalancer
  selector:
    app: marketplace
  ports:
    - protocol: TCP
      port: 5000
      targetPort: 5000
---
apiVersion: v1
kind: Service
metadata:
  name: auth
spec:
  type: LoadBalancer
  selector:
    app: auth
  ports:
    - protocol: TCP
      port: 50052
      targetPort: 50052

---
apiVersion: v1
kind: Secret
metadata:
  name: firebase-config
type: Opaque
stringData:
  API_KEY: {{ api_key }}
  AUTH_DOMAIN: {{ auth_domain }}
  PROJECT_ID: {{ project_id }}
  STORAGE_BUCKET: {{ storage_bucket }}
  MESSAGING_SENDER_ID: {{ messaging_sender_id }}
  APP_ID: {{ app_id }}
  MEASUREMENT_ID: {{ measurement_id }}
